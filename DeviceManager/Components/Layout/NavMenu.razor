@using DeviceManager.Models;
@using System.Text.Json;

<div class="top-row ps-3 navbar navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href=""> <span>
                <svg width="27" height="28" viewBox="0 0 27 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0_1044_86)">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M16.9163 8.49618C15.8277 7.76884 14.548 7.38062 13.2388 7.38062V0.76123C15.8571 0.76123 18.4167 1.53767 20.5938 2.99237C22.7709 4.44706 24.4678 6.51467 25.4698 8.93372C26.4718 11.3528 26.734 14.0147 26.2232 16.5828C25.7123 19.1508 24.4515 21.5098 22.6 23.3612C20.7485 25.2127 18.3896 26.4736 15.8215 26.9844C13.2535 27.4952 10.5915 27.233 8.17249 26.231C5.75344 25.229 3.68583 23.5322 2.23114 21.3551C0.776441 19.1779 0 16.6184 0 14H6.61938C6.61938 15.3092 7.00761 16.589 7.73495 17.6775C8.46229 18.7661 9.4961 19.6145 10.7057 20.1155C11.9152 20.6165 13.2461 20.7476 14.5301 20.4922C15.8142 20.2368 16.9936 19.6064 17.9194 18.6806C18.8451 17.7548 19.4756 16.5754 19.7309 15.2914C19.9864 14.0073 19.8553 12.6764 19.3543 11.4669C18.8533 10.2573 18.0049 9.22352 16.9163 8.49618Z" fill="#007DFC" />
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M6.61938 0.761233C6.61938 1.6305 6.44817 2.49126 6.11551 3.29436C5.78286 4.09746 5.29528 4.82718 4.68061 5.44185C4.06595 6.05652 3.33623 6.54409 2.53313 6.87675C1.73003 7.2094 0.869268 7.38062 2.8934e-07 7.38062L0 14C1.73854 14 3.46006 13.6576 5.06626 12.9923C6.67247 12.327 8.13191 11.3518 9.3612 10.1224C10.5906 8.89315 11.5657 7.43371 12.231 5.82749C12.8963 4.22128 13.2388 2.49977 13.2388 0.76123L6.61938 0.761233Z" fill="#007DFC" />
                    </g>
                    <defs>
                        <clipPath id="clip0_1044_86">
                            <rect width="26.4775" height="26.4775" fill="white" transform="translate(0 0.76123)" />
                        </clipPath>
                    </defs>
                </svg>

        </span> Device Manager</a>

    </div>
</div>

<input type="checkbox" title="Navigation menu" class="navbar-toggler" />

<div class="nav-scrollable" onclick="document.querySelector('.navbar-toggler').click()">
    <nav class="flex-column">
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                @* <span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span> Home *@
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house-door-fill" viewBox="0 0 16 16">
                        <path d="M6.5 14.5v-3.505c0-.245.25-.495.5-.495h2c.25 0 .5.25.5.5v3.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5" />
                    </svg>
                </span>
                Home
            </NavLink>
        </div>
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="devices">
                @* <span class="bi bi-tablet-fill-nav-menu" aria-hidden="true"></span> Devices *@
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-tablet-fill" viewBox="0 0 16 16">
                        <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2zm7 11a1 1 0 1 0-2 0 1 1 0 0 0 2 0" />
                    </svg>
                </span>
                Devices
            </NavLink>
        </div>
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="support">
                @* <span class="bi bi-headset-nav-menu" aria-hidden="true"></span> Support *@
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-headset" viewBox="0 0 16 16">
                        <path d="M8 1a5 5 0 0 0-5 5v1h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V6a6 6 0 1 1 12 0v6a2.5 2.5 0 0 1-2.5 2.5H9.366a1 1 0 0 1-.866.5h-1a1 1 0 1 1 0-2h1a1 1 0 0 1 .866.5H11.5A1.5 1.5 0 0 0 13 12h-1a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h1V6a5 5 0 0 0-5-5" />
                    </svg>
                </span>
                Support

            </NavLink>
        </div>
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="settings">
                @* <span class="bi bi-gear-fill-nav-menu"></span> Settings *@
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-gear-fill" viewBox="0 0 16 16">
                        <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z" />
                    </svg>
                </span>
                Settings
            </NavLink>
        </div>
            @if (user == null)
            {
            <p>Loading...</p>
        }
        else
        {
            <div class="logout">
                <img class="rounded-avatar" src="Images/profile1.jpg">
                <div class="user-details">
                    <div>
                        @{
                            var udn = user?.displayName ?? string.Empty;
                        }
                        @udn
                    </div>
                    <p class="secondary-color">
                        @{
                            var email = user?.mail ?? string.Empty;
                            var maxCharacters = 13;
                            var truncatedEmail = email.Length > maxCharacters ? email.Substring(0, maxCharacters) + "..." : email;
                        }
                        @truncatedEmail
                    </p>
                </div>
                 <NavLink class="nav-link" href="profile">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z" />
                        <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z" />
                    </svg>
                </NavLink>
            </div>
            }
    </nav>
</div>

@code{
    private User user;
    protected override void OnInitialized()
    {
        string filePath = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, "graph.json");
        try
        {
            if (File.Exists(filePath))
            {
                string jsonContent = File.ReadAllText(filePath);
                user = JsonSerializer.Deserialize<User>(jsonContent);
            }
            else
            {
            }
        }
        catch (Exception ex)
        {
        }
    }
}
